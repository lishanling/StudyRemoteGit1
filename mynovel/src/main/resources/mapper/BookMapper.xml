<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yc.novel.mapper.BookMapper">
	
	<resultMap type="PaginationBean" id="PaginationBeanMap">
		<collection property="rows" column="{pageSize=pageSize,currPage=currPage}" ofType="Book" select="getBooks"/>
	</resultMap>
	<select id="findPartBooks" parameterType="PaginationBean" resultMap="PaginationBeanMap">
		select count(1) total,ceil(count(1)/${pageSize}) totalPage,${pageSize} pageSize,${currPage} currPage from book
	</select>
	<select id="getBooks" resultType="Book">
	select * from (select n.*,rownum rn from 
		(select * from book order by 1) n where ${pageSize}*${currPage}>=rownum)
		where rn>${pageSize}*(${currPage}-1) 
	</select>
	
	<update id="updateBook" parameterType="Book">
	 update book <set>
	 <if test="bname!=null">bname=#{bname},</if>
	  <if test="bdesc!=null">bdesc=#{bdesc},</if>
	  <if test="bdate!=null">bdate=#{bdate},</if>
	 <if test="bcopyright!=null">bcopyright=#{bcopyright},</if>
	 <if test="burl!=null">burl=#{burl},</if>
	 <if test="bauthor!=null">bauthor=#{bauthor},</if>
	 <!-- <if test="ssid!=null">ssid=#{ssid},</if> -->
	 <if test="bpic!=null">bpic=#{bpic}</if> 
	 </set>
	 where bid=#{bid}
	</update>
	
	<insert id="insertBook" parameterType="Book">
	<selectKey order="BEFORE" keyColumn="ssid" keyProperty="ssid">
	select ssid from types where sname=#{sname}
	</selectKey>
	insert into book values()
	</insert>
</mapper>